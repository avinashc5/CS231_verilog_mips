.data
	a: .word 9314, 4491, 3463, 5702, 1682, 5721, 8779, 5136, 5835, 7726, 3068, 2318, 902, 6801, 6890, 7134, 4558, 9517, 3748, 90, 2431, 2066, 5223, 6100, 3903, 5907, 3476, 9767, 4469, 6307, 3990, 2717, 1027, 9977, 8007, 4971, 4567, 744, 5295, 1800, 7462, 6341, 5227, 7453, 1941, 204, 8602, 298, 649, 7979, 4868, 9621, 5302, 24, 9229, 2900, 1878, 7695, 2028, 6456, 4879, 8312, 2828, 9167, 8789, 3679, 5126, 6229, 1219, 4097, 6566, 9109, 2118, 1638, 4514, 7391, 9263, 67, 8601, 9170, 9865, 8874, 2442, 3493, 7345, 8669, 4736, 3999, 3449, 202, 9504, 3920, 7052, 1335, 6682, 6313, 9010, 3115, 7799, 7268, 1000, 1568, 6362, 6759, 3010, 6596, 7962, 4596, 1407, 5369, 8169, 2326, 7845, 1373, 8366, 6102, 1171, 3347, 2984, 2097, 1314, 6913, 169, 6401, 2669, 6385, 5487, 6954, 5121, 7822, 6308, 1347, 5454, 1539, 5261, 1579, 4483, 8273, 9505, 510, 3647, 410, 9464, 6022, 4852, 6708, 3640, 3572, 1508, 4767, 2903, 3632, 4307, 7477, 9053, 2761, 935, 1575, 8916, 2863, 7873, 6293, 9702, 1073, 1106, 6178, 6561, 5257, 2870, 2412, 7742, 2268, 7279, 1681, 2782, 9465, 463, 5885, 7083, 4924, 5924, 1037, 9031, 1091, 8897, 8030, 1803, 7658, 3248, 4202, 5911, 7897, 8308, 1371, 8340, 9778, 1156, 3644, 383, 310, 7034, 471, 2893, 5770, 892, 4934, 3697, 1767, 4457, 794, 3480, 7863, 3847, 2249, 6656, 2090, 7293, 9250, 4548, 7352, 4679, 396, 3831, 544, 5189, 4448, 9870, 4620, 4102, 5060, 9898, 568, 7077, 6303, 1754, 8114, 7404, 1397, 7172, 1304, 2416, 7876, 2821, 4303, 2395, 8349, 8395, 3457, 4195, 7486, 3569, 1904, 5577, 5284, 8703, 2848, 1209, 1325, 6156, 6762, 2306, 7137, 8730, 5900, 1543, 4277, 6672, 4070, 6881, 4220, 3948, 7967, 9117, 8871, 5971, 5901, 771, 4081, 8229, 5856, 4235, 85, 6735, 8370, 7728, 567, 5919, 7634, 4346, 6138, 29, 3055, 972, 4908, 4481, 1877, 2071, 5179, 3000, 9823, 9007, 8782, 4176, 6130, 4169, 7256, 1633, 4532, 958, 5172, 3567, 8752, 5397, 4833, 1676, 2321, 2608, 1113, 4489, 1450, 5540, 5398, 1354, 7632, 7244, 1241, 9646, 4371, 3610, 871, 5918, 4365, 5444, 334, 938, 1465, 8416, 8996, 8878, 5857, 6861, 2628, 7633, 4655, 5990, 5870, 9266, 6841, 8760, 7247, 8067, 6277, 9906, 5076, 7552, 3629, 7895, 3505, 1236, 5392, 7474, 3931, 4096, 8777, 1545, 8251, 9709, 9592, 2539, 4225, 8659, 6784, 5405, 8474, 1798, 2458, 6563, 7069, 8899, 6521, 8880, 2417, 8549, 8423, 3262, 2351, 2398, 3167, 6417, 6850, 1048, 6502, 816, 332, 988, 2741, 4705, 8948, 3304, 6964, 450, 4484, 9371, 3018, 5532, 3223, 8820, 7973, 2642, 4193, 3619, 3342, 628, 17, 6879, 3238, 9743, 3936, 4552, 4078, 8762, 622, 1443, 4925, 1231, 2675, 140, 2187, 4764, 1426, 4888, 5832, 1393, 4667, 5512, 7502, 5598, 8320, 9286, 8984, 7529, 8879, 1, 4525, 7659, 1009, 3813, 5649, 440, 3335, 4342, 8218, 5229, 496, 5736, 3536, 2330, 6217, 3441, 4330, 1611, 4880, 9201, 2425, 4461, 9104, 6422, 3029, 1199, 9687, 126, 53, 7118, 9544, 1886, 5433, 2142, 454, 7377, 7604, 4765, 1152, 8823, 9029, 1413, 9181, 3716, 9673, 184, 4466, 7910, 6644, 7458, 8381, 6372, 635, 9277, 3422, 6328, 7724, 4673, 8596, 4589, 4433, 4754, 4411, 9210, 1101, 8294, 9479, 9781, 5238, 4840, 9218, 1695, 4808, 5701, 6485, 9108, 2354, 5166, 420, 9679, 16, 1332, 7043, 1567, 4279, 5622, 1586, 9828, 8822, 1628, 9321, 6771, 8769, 2466, 8876, 1214, 348, 4641, 8877, 8825, 1187, 9829, 7346, 1441, 1760, 4604, 9359, 1334, 8124, 441, 4067, 9955, 772, 4543, 8282, 4843, 6221, 3969, 7559, 4336, 3317, 1029, 5219, 3434, 7202, 3296, 5637, 3630, 697, 7307, 2537, 2382, 3168, 1885, 1473, 2678, 2455, 4887, 937, 9513, 910, 8111, 4838, 4405, 9179, 6024, 6114, 4940, 6634, 3182, 6265, 277, 1288, 634, 985, 4293, 7992, 3458, 2622, 987, 4410, 5246, 3231, 347, 1294, 1015, 842, 9990, 5737, 4933, 9772, 1969, 857, 5185, 3430, 495, 3345, 148, 3307, 4700, 8493, 7722, 8497, 6688, 7538, 1973, 679, 6001, 6574, 5287, 6864, 2590, 6997, 9748, 894, 9649, 9766, 6905, 7272, 344, 6780, 3816, 3021, 6694, 6593, 8309, 1513, 3179, 9193, 473, 229, 280, 5271, 8766, 5351, 6028, 5710, 2758, 1482, 221, 504, 5419, 5269, 4687, 7830, 1532, 1039, 5233, 7794, 2803, 1061, 4806, 7056, 4564, 7401, 1874, 2518, 7513, 6569, 6903, 4215, 8501, 5462, 3841, 1018, 1175, 1462, 218, 1418, 2018, 5111, 6003, 183, 6260, 3303, 6478, 1701, 4294, 8519, 2328, 151, 2740, 9794, 2407, 167, 1078, 4048, 9765, 7667, 6326, 1755, 9354, 3804, 1028, 8136, 3918, 8496, 5715, 9631, 6980, 163, 478, 2987, 7290, 3670, 7461, 3206, 1890, 6662, 8352, 2254, 5772, 4333, 7939, 5174, 5120, 6273, 413, 1967, 8383, 1216, 3358, 331, 3273, 868, 1909, 6595, 8279, 1702, 6175, 3232, 5679, 8884, 3573, 5158, 2111, 4793, 4228, 7879, 861, 4273, 2140, 3672, 8713, 7720, 636, 1942, 9497, 1307, 9708, 8720, 2797, 6000, 5537, 819, 3599, 1731, 7337, 7580, 6115, 7715, 5418, 746, 5209, 5348, 2597, 5573, 6865, 1559, 513, 32, 8491, 3083, 3617, 9399, 4047, 498, 2147, 8145, 8783, 3846, 4339, 3258, 7617, 6815, 4913, 8371, 8613, 2842, 9659, 9245, 751, 2468, 133, 1164, 6697, 1341, 1128, 6826, 7956, 1520, 8567, 7387, 831, 4599, 545, 387, 8297, 1970, 3137, 3898, 1111, 91, 7839, 1117, 8945, 2456, 9857, 6270, 3264, 8522, 5552, 3616, 5565, 5165, 872, 3901, 2387, 9769, 2535, 4784, 6388, 9019, 8232, 3501, 1234, 9391, 4459, 8999, 4603, 4309, 2309, 9895, 2359, 5966, 7314, 2930, 7245, 1283, 9998, 2094, 2692, 8826, 6679, 928, 1245, 7641, 1071, 6233, 7844, 1483, 535, 6790, 4439, 5124, 2107, 4316, 4062, 3698, 4607, 7915, 3540, 1809, 1621, 8617, 9760, 663, 8006, 4719, 7587, 2682, 5852, 2166, 5719, 1984, 503, 4753, 8272, 7969, 8717, 9727, 1976, 9787, 9340, 5728, 1072, 2652, 9897, 548, 536, 2500, 8214, 6009, 6310, 742, 6638, 2063, 7044, 1875, 4272, 9698, 301, 6034, 5757, 4895, 45, 4684, 2599, 5102, 6505, 4848, 492, 7358, 7729, 9212, 6651, 1892, 3863, 7330, 630, 7840, 7934, 9059, 6226, 13, 3376, 1773, 8120, 1615, 2084, 631, 9575, 4739, 4544, 4025, 1385, 1873, 4782, 311, 8342, 4520, 2469, 5026, 4425, 3886, 7299, 675, 2479, 4535, 3899, 7978, 4571, 1177, 5932, 6248, 7941, 7081, 1641, 780, 1944, 870, 293, 1569, 5531, 7156, 3180, 7678
	n: .word 1000
.text
	j MAIN

MERGE:
	#  Store everything into the stack
	addi $sp, $sp, -20
	sw $ra, 0($sp)
	sw $a0, 4($sp)
	sw $a1, 8($sp)
	sw $a2, 12($sp)
	sw $a3, 16($sp)

	# $s0 = n1 = l
	add $s0, $zero, $a1
	# $s1 = n2 = m+1
	addi $s1, $a2, 1

	# $s2 = r-l
	sub $s2, $a3, $a1
	# $s2 = r-l+1
	addi $s2, $s2, 1
	# $t0 = (r-l+1)*4
	sll $t0, $s2, 2
	# Creating space for the copy of the array created after merge
	sub $sp, $sp, $t0

	# $s3 = i = 0
	addi $s3, $zero, 0

WHILE_COND:
	# i < r-l+1			$s3 < $s2
	slt $t0, $s3, $s2
	beq $t0, $zero, EXIT_WHILE

WHILE_LOOP:
	# $s4 = a[n1]
	sll $t0, $s0, 2
	add $t0, $a0, $t0
	lw $s4, 0($t0)

	# $s5 = a[n2]
	sll $t0, $s1, 2
	add $t0, $a0, $t0
	lw $s5, 0($t0)

	# n1 <= m && n2 <= r
	slt $t0, $a2, $s0 # $t0 = ~(n1 <= m)
	slt $t1, $a3, $s1 # $t1 = ~(n2 <= r)
	or $t2, $t0, $t1 # $t2 = ~(n1 <= m && n2 <= r)
	
	beq $t2, $zero, BOTH # if (n1 <= m && n2 <= r
	beq $t0, $zero, N1 # if (n1 <= m)
	beq $t1, $zero, N2 # if (n2 <= r)
	# else jump to i++
	j INCREMENT_I

BOTH:
	# $t0 = a[n1] < a[n2]
	slt $t0, $s4, $s5
	# if (a[n1] >= a[n2]) do n2
	beq $t0, $zero, N2
	# else do n1
	j N1

N1:
	# $t0 = 4*i
	sll $t0, $s3, 2
	# $t0 = $sp + 4*i
	add $t0, $t0, $sp
	# arr[i] = a[n1]
	sw $s4, 0($t0)
	# n1++
	addi $s0, $s0, 1
	
	j INCREMENT_I

N2:
	# $t0 = 4*i
	sll $t0, $s3, 2
	# $t0 = $sp + 4*i
	add $t0, $t0, $sp
	# arr[i] = a[n2]
	sw $s5, 0($t0)
	# n2++
	addi $s1, $s1, 1
	
	j INCREMENT_I


INCREMENT_I:
	# i++
	addi $s3, $s3, 1
	# Jump back to the conditions of while
	j WHILE_COND

EXIT_WHILE:
	# $s3 = i = 0
	addi $s3, $zero, 0

FOR_LOOP_COND:
	# i < r-l+1
	slt $t0, $s3, $s2
	beq $t0, $zero, EXIT_FOR
	
FOR_LOOP:
	# $t0 = i + l
	add $t0, $a1, $s3
	# $t0 = 4*(i+l)
	sll $t0, $t0, 2
	# $t1 = 4*i
	sll $t1, $s3, 2
	# $t1 = arr[i]
	add $t1, $t1, $sp
	lw $t1, 0($t1)
	# 0($t0) = a[l+i] = $t1
	add $t0, $t0, $a0
	sw $t1, 0($t0)

	# i++
	addi $s3, $s3, 1

	j FOR_LOOP_COND


EXIT_FOR:
	sll $t0, $s2, 2
	add $sp, $sp, $t0


	lw $ra, 0($sp)
	lw $a0, 4($sp)
	lw $a1, 8($sp)
	lw $a2, 12($sp)
	lw $a3, 16($sp)
	addi $sp, $sp, 20

	jr $ra
	

MERGE_SORT:
	# Store everything into the stack
	addi $sp, $sp, -16
	sw $ra, 0($sp)
	sw $a0, 4($sp)
	sw $a1, 8($sp)
	sw $a2, 12($sp)

	# if (r < l) return
	slt $t0, $a1, $a2
	beq $t0, $zero, RETURN_MERGE_SORT

	# $t0 = l+r
	add $t0, $a1, $a2
	# $a3 = (l+r)/2 = m
	srl $a3, $t0, 1

	# $a2 = m = $a3
	add $a2, $zero, $a3

	jal MERGE_SORT

	# $a1 = $a3 + 1 = m + 1
	addi $a1, $a3, 1
	# $a2 = r 12($sp)
	lw $a2, 12($sp)

	jal MERGE_SORT

	# $a1 = l
	lw $a1, 8($sp)
	# $a3 = r
	lw $a3, 12($sp)
	# $a2 = $a1 + $a3
	add $a2, $a1, $a3
	# $a2 = (l+r)/2
	srl $a2, $a2, 1

	jal MERGE

RETURN_MERGE_SORT:
	lw $ra, 0($sp)
	lw $a0, 4($sp)
	lw $a1, 8($sp)
	lw $a2, 12($sp)
	addi $sp, $sp, 16

	jr $ra


MAIN:
	lw $s0, n
	la $a0, a
	addi $a1, $zero, 0
	addi $a2, $s0, -1
	
	jal MERGE_SORT

	addi $v0, $zero, 10
	syscall
